resource_types:
  - name: keyval
    type: docker-image
    source:
      repository: swce/keyval-resource

resources:
  - name: keyval
    type: keyval

  - name: myfork
    type: git
    source:
      uri: https://github.com/jeffwatts/concourse-tutorial
      branch: jeff/noodling

jobs:

  - name: build
    plan:
      - get: myfork
      - task: set-up-props
        config:
          platform: linux
          image_resource:
            type: docker-image
            source:
              repository: busybox
          inputs:
            - name: myfork
          outputs:
            - name: keyvalout
          run:
            path: myfork/jeffpipeline/set-up-props.sh
      - put: keyval
        params:
          file: keyvalout/keyval.properties

  - name: post-build
    plan:
      - get: myfork
      - get: keyval
        passed:
          - build
      - task: val-check
        config:
          platform: linux
          image_resource:
            type: docker-image
            source:
              repository: busybox
          inputs:
            - name: myfork
            - name: keyval
          run:
            path: myfork/jeffpipeline/read-props.sh

